<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª</title>
    <style>
        /* CSS Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… (Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚) */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ffe6f0, #ffffff);
            color: #333;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Ù‚Ù„ÙˆØ¨ Ù…ØªØ­Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© */
        .heart {
            position: absolute;
            color: #ff69b4;
            font-size: 20px;
            animation: float 6s infinite linear;
            opacity: 0.7;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }
        
        /* ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #entrance {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .password-box {
            text-align: center;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            background: white;
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        input[type="password"] {
            padding: 15px;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            font-size: 18px;
            width: 250px;
            margin: 10px 0;
            text-align: center;
        }
        
        button {
            padding: 15px 30px;
            background: #ff69b4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #ff1493;
        }
        
        /* ØµÙØ­Ø© Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª */
        #memories {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .gallery {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .memory-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
            padding-bottom: 10px;
            position: relative;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .memory-card img, .memory-card video {
            width: 100%;
            height: 120px; /* Ù…ØµØºØ±Ø© ÙˆØ·ÙˆÙŠÙ„Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§ */
            object-fit: cover;
        }
        
        .memory-description {
            padding: 10px;
            font-size: 14px;
            color: #666;
            text-align: center;
            background: #f9f9f9;
            margin-top: 10px;
            border-radius: 10px;
        }
        
        .card-actions {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #ffe6f0;
            border-top: 1px solid #ff69b4;
        }
        
        .card-actions button {
            padding: 8px 15px;
            font-size: 14px;
            margin: 0;
        }
        
        /* Ø²Ø± Ø§Ù„Ø±ÙØ¹ */
        #upload-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ff69b4;
            color: white;
            font-size: 30px;
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        #upload-btn:hover {
            transform: scale(1.1);
        }
        
        #file-input {
            display: none;
        }
        
        /* Popup Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØµÙ */
        #description-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 300px;
            text-align: center;
        }
        
        #description-popup input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ff69b4;
            border-radius: 5px;
        }
        
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .gallery {
                gap: 15px;
            }
            .memory-card img, .memory-card video {
                height: 100px; /* Ø£ØµØºØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            }
            .password-box {
                width: 90%;
            }
            #description-popup {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Ù‚Ù„ÙˆØ¨ Ù…ØªØ­Ø±ÙƒØ© -->
    <div id="hearts"></div>
    
    <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="entrance">
        <div class="password-box">
            <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª ğŸ’–</h1>
            <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <br>
            <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
            <br>
            <button onclick="showForgot()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>
            <div id="forgot-section" style="display: none;">
                <input type="password" id="alt-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©">
                <br>
                <button onclick="checkAltPassword()">ØªØ­Ù‚Ù‚</button>
            </div>
        </div>
    </div>
    
    <!-- ØµÙØ­Ø© Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª -->
    <div id="memories">
        <h1 style="text-align: center; color: #ff69b4;">Ø°ÙƒØ±ÙŠØ§ØªÙƒ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© âœ¨</h1>
        <div class="gallery" id="gallery"></div>
        <button id="upload-btn">+</button>
        <input type="file" id="file-input" accept="image/*,video/*" multiple>
    </div>
    
    <!-- Popup Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØµÙ -->
    <div id="overlay"></div>
    <div id="description-popup">
        <h3 id="popup-title">Ø£Ø¶Ù ÙˆØµÙÙ‹Ø§ Ù„Ù„Ø°ÙƒØ±Ù‰</h3>
        <input type="text" id="description-input" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙÙ‹Ø§ Ù‚ØµÙŠØ±Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <br>
        <button onclick="saveMemory()">Ø­ÙØ¸</button>
        <button onclick="cancelUpload()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
    
    <script>
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ù„ÙˆØ¨ Ù…ØªØ­Ø±ÙƒØ©
        function createHearts() {
            const heartsContainer = document.getElementById('hearts');
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = 'â¤ï¸';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDelay = Math.random() * 6 + 's';
                heartsContainer.appendChild(heart);
            }
        }
        createHearts();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function checkPassword() {
            const password = document.getElementById('password').value;
            if (password === '852009') {
                document.getElementById('entrance').style.display = 'none';
                document.getElementById('memories').style.display = 'block';
                loadMemories();
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
            }
        }
        
        // Ø¹Ø±Ø¶ Ù‚Ø³Ù… "Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
        function showForgot() {
            document.getElementById('forgot-section').style.display = 'block';
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
        function checkAltPassword() {
            const altPassword = document.getElementById('alt-password').value;
            if (altPassword === '242008') {
                document.getElementById('entrance').style.display = 'none';
                document.getElementById('memories').style.display = 'block';
                loadMemories();
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ø®Ø§Ø·Ø¦Ø©!');
            }
        }
        
        // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª IndexedDB
        let db;
        const request = indexedDB.open('MemoriesDB', 1);
        request.onupgradeneeded = (event) => {
            db = event.target.result;
            if (!db.objectStoreNames.contains('memories')) {
                db.createObjectStore('memories', { keyPath: 'id', autoIncrement: true });
            }
        };
        request.onsuccess = (event) => {
            db = event.target.result;
        };
        request.onerror = (event) => {
            console.error('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ IndexedDB:', event.target.error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø¬Ø±Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
        };
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ù…Ù† IndexedDB
        function loadMemories() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            const transaction = db.transaction(['memories'], 'readonly');
            const store = transaction.objectStore('memories');
            const request = store.getAll();
            request.onsuccess = () => {
                const memories = request.result;
                memories.forEach(memory => {
                    const card = document.createElement('div');
                    card.className = 'memory-card';
                    let mediaHTML = '';
                    if (memory.type.startsWith('image/')) {
                        const url = URL.createObjectURL(memory.blob);
                        mediaHTML = `<img src="${url}" alt="Ø°ÙƒØ±Ù‰">`;
                    } else if (memory.type.startsWith('video/')) {
                        const url = URL.createObjectURL(memory.blob);
                        mediaHTML = `<video controls><source src="${url}" type="${memory.type}"></video>`;
                    }
                    const descriptionHTML = memory.description ? `<div class="memory-description">${memory.description}</div>` : '';
                    const actionsHTML = `
                        <div class="card-actions">
                            <button onclick="editMemory(${memory.id}, '${memory.description || ''}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="deleteMemory(${memory.id})" style="background: #ff4444;">Ø­Ø°Ù</button>
                        </div>
                    `;
                    card.innerHTML = mediaHTML + descriptionHTML + actionsHTML;
                    gallery.appendChild(card);
                });
            };
            request.onerror = () => {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª.');
            };
        }
        
        let selectedFiles = [];
        let editingId = null;
        
        // Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        document.getElementById('upload-btn').addEventListener('click', () => {
            document.getElementById('file-input').click();
        });
        
        document.getElementById('file-input').addEventListener('change', (e) => {
            selectedFiles = Array.from(e.target.files);
            if (selectedFiles.length > 0) {
                document.getElementById('overlay').style.display = 'block';
                document.getElementById('description-popup').style.display = 'block';
                document.getElementById('popup-title').textContent = 'Ø£Ø¶Ù ÙˆØµÙÙ‹Ø§ Ù„Ù„Ø°ÙƒØ±Ù‰';
                editingId = null;
            }
        });
        
        // Ø­ÙØ¸ Ø§Ù„Ø°ÙƒØ±Ù‰ Ù…Ø¹ Ø§Ù„ÙˆØµÙ ÙÙŠ IndexedDB
        async function saveMemory() {
            const description = document.getElementById('description-input').value;
            const transaction = db.transaction(['memories'], 'readwrite');
            const store = transaction.objectStore('memories');
            
            if (editingId !== null) {
                // ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯
                const request = store.get(editingId);
                request.onsuccess = () => {
                    const memory = request.result;
                    memory.description = description;
                    store.put(memory);
                    alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                    loadMemories();
                };
                request.onerror = () => alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.');
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
                let successCount = 0;
                for (const file of selectedFiles) {
                    try {
                        await new Promise((resolve, reject) => {
                            const request = store.add({ blob: file, type: file.type, description: description });
                            request.onsuccess = resolve;
                            request.onerror = reject;
                        });
                        successCount++;
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù:', file.name, error);
                    }
                }
                if (successCount > 0) {
                    alert(`ØªÙ… Ø­ÙØ¸ ${successCount} Ø°ÙƒØ±Ù‰ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰`);
                    loadMemories();
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø£ÙŠ Ø°ÙƒØ±ÙŠØ§Øª. Ø¬Ø±Ø¨ Ù…Ø±Ø© ØªØ§Ù†ÙŠØ©.');
                }
            }
            cancelUpload();
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø°ÙƒØ±Ù‰
        function editMemory(id, currentDescription) {
            editingId = id;
            document.getElementById('description-input').value = currentDescription;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('description-popup').style.display = 'block';
            document.getElementById('popup-title').textContent = 'Ø¹Ø¯Ù„ Ø§Ù„ÙˆØµÙ';
        }
        
        // Ø­Ø°Ù Ø°ÙƒØ±Ù‰
        function deleteMemory(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø°ÙƒØ±Ù‰ØŸ')) {
                const transaction = db.transaction(['memories'], 'readwrite');
                const store = transaction.objectStore('memories');
                const request = store.delete(id);
                request.onsuccess = () => {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø°ÙƒØ±Ù‰ Ø¨Ù†Ø¬Ø§Ø­!');
                    loadMemories();
                };
                request.onerror = () => alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù.');
            }
        }
        
        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±ÙØ¹ Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function cancelUpload() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('description-popup').style.display = 'none';
            document.getElementById('description-input').value = '';
            document.getElementById('file-input').value = '';
            selectedFiles = [];
            editingId = null;
        }
    </script>
</body>
</html>
